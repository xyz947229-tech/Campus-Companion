<!DOCTYPE html><html lang="en" ng-app="campusApp"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Companion | Student Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .navy-bg { background-color: #1e3a8a; }
        .navy-text { color: #1e3a8a; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .sidebar-link { transition: 0.3s; cursor: pointer; }
        .sidebar-link:hover { background: #2563eb; }
        .active-tab { background: #2563eb; border-left: 4px solid #fff; }
        .chat-container { height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; padding: 1rem; }
        .bubble { max-width: 80%; padding: 0.75rem 1rem; border-radius: 1rem; font-size: 0.875rem; line-height: 1.25rem; }
        .bubble-ai { background: #eff6ff; color: #1e40af; align-self: flex-start; border-bottom-left-radius: 0; border: 1px solid #dbeafe; }
        .bubble-user { background: #1e3a8a; color: white; align-self: flex-end; border-bottom-right-radius: 0; }
    </style></head><body ng-controller="MainController">

    <div ng-if="!isLoggedIn" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 bg-opacity-90">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md">
            <h1 class="text-3xl font-bold navy-text mb-2">Campus Companion</h1>
            <p class="text-gray-500 mb-6">Your All-in-One Student Management Hub</p>
            <button ng-click="login()" class="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 p-3 rounded-lg hover:bg-gray-50 transition">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20">
                <span class="font-semibold">Sign in with Google (HOD/Student)</span>
            </button>
        </div>
    </div>

    <div class="flex min-h-screen" ng-if="isLoggedIn">
        <aside class="w-64 navy-bg text-white hidden md:block">
            <div class="p-6 text-xl font-bold border-b border-blue-800">CAMPUS COMPANION</div>
            <nav class="mt-6">
                <div ng-repeat="tab in tabs" 
                     ng-click="setView(tab.id)"
                     class="sidebar-link p-4 flex items-center gap-3"
                     ng-class="{'active-tab': currentView === tab.id}">
                    <i class="fas {{tab.icon}} w-6"></i> {{tab.name}}
                </div>
            </nav>
            <div class="absolute bottom-0 w-64 p-6 border-t border-blue-800">
                <p class="text-xs text-blue-300">Signed in as:</p>
                <p class="text-sm font-medium">{{user.name}}</p>
                <button ng-click="logout()" class="mt-4 text-xs underline">Logout</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="h-16 bg-white border-b flex items-center justify-between px-8">
                <h2 class="text-xl font-semibold navy-text">{{getViewTitle()}}</h2>
                <div class="flex items-center gap-4">
                    <span class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs font-bold">
                        Fees Due: {{feesDue | currency:"₹"}}
                    </span>
                    <i class="fas fa-bell text-gray-400"></i>
                </div>
            </header>

            <section class="p-8 overflow-y-auto">
                
                <div ng-show="currentView === 'expenses'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="card p-6 border-l-4 border-blue-500 bg-blue-50/30">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Credit (Budget)</p>
                                    <h3 class="text-2xl font-bold text-blue-700">{{monthlyBudget | currency:"₹"}}</h3>
                                </div>
                                <i class="fas fa-university text-blue-200 text-2xl"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-red-500 bg-red-50/30">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Debit (Spent)</p>
                                    <h3 class="text-2xl font-bold text-red-700">{{getTotalExpenses() | currency:"₹"}}</h3>
                                </div>
                                <i class="fas fa-arrow-trend-down text-red-200 text-2xl"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-green-500 bg-green-50/30">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Net Balance</p>
                                    <h3 class="text-2xl font-bold text-green-700">{{ (monthlyBudget - getTotalExpenses()) | currency:"₹"}}</h3>
                                </div>
                                <i class="fas fa-wallet text-green-200 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h4 class="font-bold mb-4 navy-text flex items-center"><i class="fas fa-plus-circle mr-2"></i>New Transaction</h4>
                        <form ng-submit="addExpense()" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 block mb-1">ITEM/VENDOR</label>
                                <input type="text" ng-model="newExp.item" placeholder="e.g. Library Cafe" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none text-sm" required>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 block mb-1">AMOUNT (₹)</label>
                                <input type="number" ng-model="newExp.amount" placeholder="0.00" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none text-sm" required>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 block mb-1">CATEGORY</label>
                                <select ng-model="newExp.category" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                    <option value="Canteen">Canteen</option>
                                    <option value="Stationery">Stationery</option>
                                    <option value="Print">Printing</option>
                                    <option value="Travel">Travel</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700 transition shadow-lg shadow-blue-100 text-sm">
                                    Save Transaction
                                </button>
                            </div>
                        </form>
                    </div>

                    <table class="w-full card overflow-hidden">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-4 text-left font-bold text-gray-400 text-xs uppercase">Date</th>
                                <th class="p-4 text-left font-bold text-gray-400 text-xs uppercase">Category</th>
                                <th class="p-4 text-left font-bold text-gray-400 text-xs uppercase">Item</th>
                                <th class="p-4 text-right font-bold text-gray-400 text-xs uppercase">Amount</th>
                                <th class="p-4 text-center font-bold text-gray-400 text-xs uppercase w-20">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="e in expenses" class="border-b hover:bg-slate-50 transition">
                                <td class="p-4 text-sm text-gray-500">{{e.date}}</td>
                                <td class="p-4"><span class="bg-blue-50 text-blue-600 px-2 py-1 rounded text-[10px] font-bold uppercase">{{e.category}}</span></td>
                                <td class="p-4 font-medium text-gray-700">{{e.item}}</td>
                                <td class="p-4 text-right font-bold text-red-500">- {{e.amount | currency:"₹"}}</td>
                                <td class="p-4 text-center">
                                    <button ng-click="deleteExpense($index)" class="text-gray-300 hover:text-red-500 transition">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div ng-show="currentView === 'ai_counselor'" class="max-w-4xl mx-auto space-y-6">
                    <div class="card p-6 bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-2xl font-bold mb-2">Campus AI Counselor</h3>
                                <p class="text-blue-100 text-sm">Powered by Advanced NLP logic. Ask anything under the sun.</p>
                            </div>
                            <i class="fas fa-brain text-4xl opacity-30"></i>
                        </div>
                    </div>
                    
                    <div class="card flex flex-col">
                        <div class="chat-container" id="chatWindow">
                            <div ng-repeat="msg in chatHistory" class="bubble" ng-class="msg.role === 'ai' ? 'bubble-ai' : 'bubble-user'">
                                <p class="whitespace-pre-line">{{msg.text}}</p>
                            </div>
                            <div ng-if="isTyping" class="bubble bubble-ai italic text-gray-400 flex items-center gap-2">
                                <i class="fas fa-circle-notch fa-spin"></i> Analyzing your query...
                            </div>
                        </div>
                        <div class="p-4 border-t bg-gray-50 flex gap-4">
                            <input type="text" ng-model="userQuery" ng-keypress="($event.which === 13)?askAI():null" placeholder="Ask me about stress, career, or general knowledge..." class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            <button ng-click="askAI()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 transition">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div ng-show="currentView === 'mess'" class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-700">Today's Menu: <span class="text-blue-600">{{currentDay}}</span></h3>
                        <button ng-click="submitMessFeedback()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg hover:bg-green-700">
                            <i class="fas fa-file-export mr-2"></i>Submit Feedback to Committee
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div ng-repeat="mealType in ['Breakfast', 'Lunch', 'Dinner']" class="card overflow-hidden border-t-4" ng-class="{'border-yellow-400': mealType=='Breakfast', 'border-blue-500': mealType=='Lunch', 'border-indigo-800': mealType=='Dinner'}">
                            <div class="p-4 bg-slate-50 border-b font-bold navy-text flex justify-between">
                                <span>{{mealType}}</span>
                                <i class="fas fa-check-circle text-green-500" ng-if="weeklyMenu[currentDay][mealType].userLiked"></i>
                            </div>
                            <div class="p-6">
                                <div class="text-xl font-bold mb-2">{{ weeklyMenu[currentDay][mealType].dish }}</div>
                                <div class="flex items-center justify-between pt-4 border-t">
                                    <button ng-click="likeMeal(currentDay, mealType)" class="text-sm font-bold transition flex items-center gap-2" ng-class="weeklyMenu[currentDay][mealType].userLiked ? 'text-pink-600' : 'text-gray-400 hover:text-pink-400'">
                                        <i class="fas fa-heart"></i> {{ weeklyMenu[currentDay][mealType].userLiked ? 'Wishlisted' : 'Add to Wishlist' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div ng-show="currentView === 'canteen'" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card p-6">
                        <h4 class="font-bold mb-4">Place Order</h4>
                        <div ng-repeat="menu in menuItems" class="flex justify-between items-center p-3 border-b">
                            <span>{{menu.name}} - {{menu.price | currency:"₹"}}</span>
                            <button ng-click="orderFood(menu)" class="bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-600 hover:text-white transition">Order</button>
                        </div>
                    </div>
                </div>

                <div ng-show="currentView === 'study'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div ng-repeat="course in courses" class="card p-6 border-t-4 border-blue-600">
                            <h4 class="text-lg font-bold navy-text mb-2">{{course.name}}</h4>
                            <button ng-click="askProfessor(course.name)" class="w-full bg-blue-600 text-white text-sm font-bold py-2 rounded">Ask Professor</button>
                        </div>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <script>
        var app = angular.module('campusApp', []);
        app.controller('MainController', function($scope, $timeout) {
            $scope.isLoggedIn = false;
            $scope.currentView = 'expenses';
            $scope.feesDue = 1250.00;
            $scope.monthlyBudget = 5000;
            $scope.user = { name: "John Doe (21BCE045)", role: "Student" };
            $scope.currentDay = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][new Date().getDay()];

            $scope.tabs = [
                { id: 'expenses', name: 'Expense Tracker', icon: 'fa-wallet' },
                { id: 'ai_counselor', name: 'AI Counselor', icon: 'fa-robot' },
                { id: 'mess', name: 'Mess Menu', icon: 'fa-utensils' },
                { id: 'study', name: 'Study Hub', icon: 'fa-book-open' },
                { id: 'emails', name: 'Smart Inbox', icon: 'fa-envelope' },
                { id: 'canteen', name: 'Canteen Order', icon: 'fa-hamburger' },
                { id: 'events', name: 'Events/Calendar', icon: 'fa-calendar-alt' }
            ];

            // AI Counselor Logic with simulated Deep Thinking
            $scope.chatHistory = [{ role: 'ai', text: "Hello! I am your Campus Companion AI. I can act as your mental health counselor, academic guide, or general knowledge base. How can I help you today?" }];
            $scope.userQuery = "";
            $scope.isTyping = false;

            $scope.askAI = function() {
                if(!$scope.userQuery) return;
                let query = $scope.userQuery;
                $scope.chatHistory.push({ role: 'user', text: query });
                $scope.userQuery = "";
                $scope.isTyping = true;

                $timeout(function() {
                    let response = "";
                    let q = query.toLowerCase();

                    // Logic for Mental Health / Counselor
                    if(q.includes("sad") || q.includes("depressed") || q.includes("stress")) {
                        response = "I'm listening. It's completely normal to feel this way under academic pressure. \n\n1. Take 5 deep breaths.\n2. Remember you are more than your grades.\n3. Should I help you plan a break schedule?";
                    } 
                    // Logic for General Knowledge (Ask anything under the sun)
                    else if(q.includes("what is") || q.includes("how to") || q.includes("why")) {
                        response = "Based on my internal database: '" + query + "' is a great question. While I am a campus AI, I suggest looking into this via research papers for deep technicality. Generally, it refers to the core concepts of exploration and logic!";
                    }
                    else if(q.includes("weather") || q.includes("time")) {
                        response = "Currently, it is " + new Date().toLocaleTimeString() + ". For weather updates, I recommend checking the local campus station, but it looks like a productive day ahead!";
                    }
                    else {
                        response = "I've processed your request. As your campus counselor, I'd say: stay curious and keep exploring. Is there anything specific about your studies or mental wellbeing you'd like to discuss?";
                    }

                    $scope.chatHistory.push({ role: 'ai', text: response });
                    $scope.isTyping = false;
                    
                    $timeout(() => {
                        let chat = document.getElementById('chatWindow');
                        if(chat) chat.scrollTop = chat.scrollHeight;
                    }, 50);
                }, 800);
            };

            // Mess Wishlist Logic
            $scope.weeklyMenu = { 
                'Monday': { 'Breakfast': { dish: 'Poha' }, 'Lunch': { dish: 'Dal Rice' }, 'Dinner': { dish: 'Paneer' } }, 
                'Tuesday': { 'Breakfast': { dish: 'Paratha' }, 'Lunch': { dish: 'Rajma' }, 'Dinner': { dish: 'Mix Veg' } }, 
                'Wednesday': { 'Breakfast': { dish: 'Idli' }, 'Lunch': { dish: 'Biryani' }, 'Dinner': { dish: 'Kadhi' } }, 
                'Thursday': { 'Breakfast': { dish: 'Sandwich' }, 'Lunch': { dish: 'Chole' }, 'Dinner': { dish: 'Gobi' } }, 
                'Friday': { 'Breakfast': { dish: 'Uttapam' }, 'Lunch': { dish: 'Black Dal' }, 'Dinner': { dish: 'Egg Curry' } }, 
                'Saturday': { 'Breakfast': { dish: 'Puri Sabji' }, 'Lunch': { dish: 'Khichdi' }, 'Dinner': { dish: 'Pav Bhaji' } }, 
                'Sunday': { 'Breakfast': { dish: 'Bread Jam' }, 'Lunch': { dish: 'Special Thali' }, 'Dinner': { dish: 'Chinese' } } 
            };

            $scope.likeMeal = function(day, mealType) {
                // Individual toggling for breakfast, lunch, dinner
                $scope.weeklyMenu[day][mealType].userLiked = !$scope.weeklyMenu[day][mealType].userLiked;
            };

            $scope.submitMessFeedback = function() {
                let likedItems = [];
                for (let day in $scope.weeklyMenu) {
                    for (let meal in $scope.weeklyMenu[day]) {
                        if ($scope.weeklyMenu[day][meal].userLiked) {
                            likedItems.push(day + " (" + meal + "): " + $scope.weeklyMenu[day][meal].dish);
                        }
                    }
                }

                if(likedItems.length === 0) {
                    alert("Please wishlist some meals before submitting feedback!");
                    return;
                }

                let docContent = "MESS FEEDBACK DOCUMENT\nGenerated by AI Assistant\n--------------------------\nStudent: " + $scope.user.name + "\n\nPreferred Dishes for Next Month:\n- " + likedItems.join("\n- ");
                
                console.log(docContent); // Sending to "System"
                alert("FEEDBACK DOCUMENT SENT!\n\nYour wishlist has been compiled into a report and sent to the Mess Committee Admin for menu planning.");
            };

            // Core functionality
            $scope.expenses = [{ date: new Date().toLocaleDateString(), item: 'Star Canteen (Samosa)', amount: 20, category: 'Canteen' }];
            $scope.courses = [{ name: 'Data Structures'}, { name: 'Operating Systems'}, { name: 'Database Systems'}];
            $scope.emails = [{ sender: 'Exam Cell', subject: 'Schedule', priority: 'High', prioValue: 3, time: '10:30 AM' }];
            $scope.menuItems = [{ name: 'Veg Sandwich', price: 40 }, { name: 'Coffee', price: 15 }];
            
            $scope.login = function() { $scope.isLoggedIn = true; };
            $scope.logout = function() { $scope.isLoggedIn = false; };
            $scope.setView = function(id) { $scope.currentView = id; };
            $scope.getViewTitle = function() { return $scope.tabs.find(t => t.id === $scope.currentView).name; };
            $scope.addExpense = function() {
                $scope.expenses.unshift({ date: new Date().toLocaleDateString(), item: $scope.newExp.item, amount: $scope.newExp.amount, category: $scope.newExp.category });
                $scope.newExp = { category: 'Canteen' };
            };
            $scope.deleteExpense = function(index) { $scope.expenses.splice(index, 1); };
            $scope.getTotalExpenses = function() { return $scope.expenses.reduce((sum, e) => sum + e.amount, 0); };
            $scope.orderFood = function(item) { alert('Order Placed!'); };
        });
    </script></body></html>